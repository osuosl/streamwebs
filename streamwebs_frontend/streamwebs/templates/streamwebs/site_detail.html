{% extends 'streamwebs/base.html' %}

{% load staticfiles %}
{% load filters %}
{% load i18n %}

{% block title %}{{ site.site_name }} - {% trans "Streamwebs" %}{% endblock %}

{% block body_title %}{{ site.site_name }}{% endblock %}

{% block content %}
  <style>
    div.resp_box {
      overflow: hidden;
      margin-bottom: 20px;
    }

    p.location {
      border-radius: 3px;
      display: inline-block;
      padding-left: 8px;
      padding-right: 8px;
      height: 27px;
      line-height: 27px;
      width: auto;
      background: teal;
      color: white;
    }
    a#camera-button {
      display: block;
      width: 100px;
      height: 60px;
      background: grey;
      color: white;
      font-size: 20px;
      border-radius: 8px;
      text-align: center;
      line-height: 20px;
      font-weight: 700;
      padding: 8px;
      transition: background 0.2s linear 0s;
    }
    a#camera-button:hover {
      background: #454545;
    }    
    .delete-icon {
      position: relative;
      bottom: 3px;
      color: black;
    }
  </style>

  <!-- site info -->
  <div class="row">
    <div class="col s12 l10 offset-l1">
      <!-- Edit -->
      <div class="row">
        <div class="col s12 center">
          {% if user.is_authenticated and perms.streamwebs.is_org_admin %}
          <button href="{% url 'streamwebs:update_site' site_slug=site.site_slug %}"
            class="btn-large teal darken-3">
            <i class="material-icons right">mode_edit</i>
            {% trans "Edit Site" %}
          </button>
          {% endif %}
        </div>
      </div>

            
      <div class="row">
        <div class="col s12 l6">
          {% if site.image %}
            <div class="resp_box">
              <img src="{{ site.image.url }}" alt="site image" id="site_detail_image" />
            </div>
          {% else %}
            <div class="resp_box">
              <img src="{% static 'streamwebs/images/img-default.jpg' %}"
              alt="site image" id="site_detail_image" />
            </div>
          {% endif %}
        </div>
        <div class="col s12 l6">
          <!-- Gmaps -->
          <div id="detail_map" class="resp_box"></div>
        </div>
      </div>
 
      <!-- Latitude and longitude -->
      <div class="row">
        <div class="center-content">
          <p class="location">
            Latitude: {{ site.location.x }},

            Longitude: {{ site.location.y }}
          <p>
        </div>
      </div>
      <div class="row">
        <div class="col s12 center-align">
          <p>{{ site.description }}</p>
        </div>
      </div>

      <div class="row">
        <!-- Graphs -->
        <div class="col s2 m2 graphs left-align">
          {% if has_wq or has_macros or has_camera %}
            <h4>{% trans "Graphs" %}</h4>
            {% if has_wq %}
              <p><a href="{% url 'streamwebs:graph_water' site.site_slug %}">
                <img src="{% static 'streamwebs/images/graph-wq.png' %}"
                alt="water quality graphs"/>
              </a></p>
            {% endif %}
            {% if has_macros %}
              <p><a href="{% url 'streamwebs:graph_macros' site.site_slug %}">
                <img src="{% static 'streamwebs/images/graph-macros.png' %}"
                alt="macroinvertebrate graphs"/>
              </a></p>
            {% endif %}
            {% if has_camera %}
              <a href="{% url 'streamwebs:site_camera' site.site_slug %}" id="camera-button">Camera Points</a>
            {% endif %}
          {% endif %}
        </div>

        <!-- Datasheets -->
        <div class="col s8 center" >
          {% if has_wq or has_macros or has_cc or has_transects or has_soil or has_camera or has_aqua %}
            <h4>{% trans "Datasheets" %}</h4>
            <ul class="collection" id="data-sheet-list">
            </ul>
            <ul class="pagination">
              <li id="first-page" class="disabled"><a href="#1">
                <i class="material-icons">fast_rewind</i>
              </a></li>
              <li id="page-1" class="page-select waves-effect"><a href="#1">1</a>
              </li>
              {% for i in data_len_range %}
              <li id="page-{{ i }}" class="page-select waves-effect"><a
                href="#{{ i }}">{{ i }}</a></li>
                {% endfor %}
              <li id="last-page" class="disabled"><a href="#{{ pages }}">
                <i class="material-icons">fast_forward</i>
              </a></li>
            </ul>
          {% else %}
            <p>{% trans "No data for this site." %}</p>
          {% endif %}
        </div>
      </div>

      <!-- Export -->
      <div class="row">
        <div class="col s4 offset-s2">
          {% if has_wq or has_macros or has_cc or has_transects or has_soil or has_aqua %}
          <select onchange="location = this.value;"
                  id="export_data" class="dropdown-button btn-large teal darken-3">
            <option value="" disabled selected hidden>{% trans "Export" %}</option>
            {% if has_wq %}
            <option value="{% url 'streamwebs:export_wq' site_slug=site.site_slug %}">
              {% trans "Water quality" %}
            </option>
            {% endif %}
            {% if has_macros %}
            <option value="{% url 'streamwebs:export_macros' site.site_slug %}">
              {% trans "Macroinvertebrates" %}
            </option>
            {% endif %}
            {% if has_transects %}
            <option value="{% url 'streamwebs:export_transects' site.site_slug %}">
              {% trans "Riparian transect" %}
            </option>
            {% endif %}
            {% if has_cc %}
            <option value="{% url 'streamwebs:export_cc' site.site_slug %}">
              {% trans "Canopy Cover Survey" %}
            </option>
            {% endif %}
            {% if has_soil %}
            <option value="{% url 'streamwebs:export_soil' site_slug=site.site_slug %}">
              {% trans "Soil Survey" %}
            </option>
            {% endif %}
            {% if has_aqua %}
            <option value="{% url 'streamwebs:export_rip_aqua' site_slug=site.site_slug %}">
              {% trans "Riparian Aquatic Survey" %}
            </option>
            {% endif %}
          </select>
          {% endif %}
        </div>

        <!-- Add data -->
        <div class="col s4">
          {% if user.is_authenticated and perms.streamwebs.is_org_author %}
          <select onchange="location = this.value;"
                  id="add_data" class="dropdown-button btn-large teal darken-3">
            <option value="" disabled selected hidden>{% trans "Add data to this site" %}</option>
            <option value="{% url 'streamwebs:water_quality_edit' site_slug=site.site_slug %}">
              {% trans "Water quality" %}
            </option>
            <option value="{% url 'streamwebs:macroinvertebrate_edit' site.site_slug %}">
              {% trans "Macroinvertebrates" %}
            </option>
            <option value="{% url 'streamwebs:riparian_transect_edit' site.site_slug %}">
              {% trans "Riparian transect" %}
            </option>
            <option value="{% url 'streamwebs:canopy_cover_edit' site.site_slug %}">
              {% trans "Canopy Cover Survey" %}
            </option>
            <option value="{% url 'streamwebs:camera_point_add' site_slug=site.site_slug %}">
              {% trans "New Camera Point" %}
            </option>
            <option value="{% url 'streamwebs:soil_edit' site_slug=site.site_slug %}">
              {% trans "Soil Survey" %}
            </option>
            <option value="{% url 'streamwebs:rip_aqua_edit' site_slug=site.site_slug %}">
              {% trans "Riparian Aquatic Survey" %}
            </option>
          </select>
          {% endif %}
        </div>

      </div>
    </div>
  </div>

{% endblock %}

{% block scripts %}
  <script type="application/javascript">
    var site_name = '{{ site.site_name }}';
    var site_slug = '{{ site.site_slug }}';
    var site_location = {x: {{ site.location.x }}, y: {{ site.location.y }} };

    var sheet_data = {{ data|safe }};
    var page_count = {{ pages }};
    var boxRatio = 2/3;
    var boxRatioNarrow = 2/5;
    var imgWidth = $('img#site_detail_image')[0].naturalWidth;
    var imgHeight = $('img#site_detail_image')[0].naturalHeight;
    var imgRatio = imgHeight/imgWidth;

    $(document).ready(function(){
      // Select first option in the selects when the page is hit.
      $("#export_data").val($("#export_data option:first").val());
      $("#add_data").val($("#add_data option:first").val());

      {% language "en-us" %}
      var loc = {
        lat: {{ site.location.y }},
        lng: {{ site.location.x }},
      };
      {% endlanguage %}
      var latlng = new google.maps.LatLng(loc.lat, loc.lng);
      var mapOptions = {
        zoom: 14,
        center: latlng,
        mapTypeControl: false,
        navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
        mapTypeId: 'roadmap'
      };
      map = new google.maps.Map($('#detail_map')[0], mapOptions);

      marker = new google.maps.Marker({
        position: loc,
        map: map,
        title: "Site Location"
      });

      // responsive function
      google.maps.event.addDomListener(window, "resize", function () {
        var center = map.getCenter();
        google.maps.event.trigger(map, "resize");
        map.setCenter(center);
      });

    });

    window.onload = function() {
        updateDimension();
        initialize();
        window.mapTypeId = {{ map_type }};
    }

    $(window).resize(function() {
        updateDimension();
    })
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api }}"></script>
  <script type="application/javascript" src="{% static 'streamwebs/js/site_detail.js' %}"></script>
  <script type="application/javascript"
          src="{% static 'streamwebs/js/site_detail.js' %}"></script>
{% endblock %}
