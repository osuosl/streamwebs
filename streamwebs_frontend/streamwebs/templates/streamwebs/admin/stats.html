{% extends 'streamwebs/base.html' %}
{% load i18n %}
{% load staticfiles %}

{% block title %}{% trans "StreamWebs Statistics" %}{% endblock %}
{% block body_title %}{% trans "StreamWebs Statistics" %}{% endblock %}
{% block head %}
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">

{% endblock %}
{% block content %}
  <div class="container">
    <form id='stats_form' method='post'>
        {% csrf_token %}
        {{ stats_form.as_p }}
        <input class="btn waves-effect teal darken-4" type='submit' name='submit'
          value='{% trans 'Calculate' %}'/>
    </form>
    <br>
    <div class="row count-row">
      <div class="col s6 count">
        <div class="card teal darken-4">
          <div class="card-content white-text">
            {% if all_time %}
              <span class="card-title">{{ users.count }}</span>
              <p>
                Users have logged in within the last 3 years
              </p>
            {% else %}
              <span class="card-title">{{ users.count }}</span>
              <p>
                Users who joined between {{ start }} and {{ end }}
              </p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="col s6 count">
        <div class="card teal darken-4">
          <div class="card-content white-text">
            <span class="card-title">{{ sheets.total }}</span>
            <p>
              Data sheets uploaded between {{ start }} and {{ end }}
            </p>
            <br>
            <p>
              {% for type, num in sheets.items %}
                <li> {{ type }}: {{ num }}</li>
              {% endfor %}
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row count-row">
      <div class="col s6 count">
        <div class="card teal darken-4">
          <div class="card-content white-text">
            <span class="card-title"> {{ schools.total }} </span>
            <p>
              Schools that uploaded data between {{ start }} and {{ end }}
            </p>
            <br>
            <input type="button" value="View All Schools"
              id = "schools-btn" class="btn teal darken-3"/>
          </div>
        </div>
      </div>

      <div class="col s6 count">
        <div class="card teal darken-4">
          <div class="card-content white-text">
            <span class="card-title"> {{ sites.total }} </span>
            <p>
              Sites that uploaded data between {{ start }} and {{ end }}
            </p>
            <br>
            <input type="button" value="View All Sites" style="margin: 0 auto;"
              id="sites-btn" class="btn teal darken-3"/>
          </div>
        </div>
      </div>
    </div>

    <div class="row schools" style="display:none;">
      <input type="button" value="Back" class="back btn teal darken-3"/>
      <table id="schools_table">
        <thead>
          <tr>
            <th>School</th>
          </tr>
        </thead>
        <tbody>
          {% for school in schools.schools %}
            <tr>
              <td>
                {{ school.name }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="row sites" style="display:none;">
      <input type="button" value="Back" class="back btn teal darken-3 s12 l4"/>
      <table id="sites_table">
        <thead>
          <tr>
            <th>Sites</th>
          </tr>
        </thead>
        <tbody>
          {% for site in sites.sites %}
            <tr>
              <td>
                {{ site.site_name }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
  <script type="application/javascript"
          src="{% static 'streamwebs/js/admin/stats.js' %}"></script>
{% endblock %}
